/**/
var rcs_mobile=new function(){this.filterActive=false;this.searchActive=false;this.panDirection=false;this.actionRowOpen=false;this.clearSelectionOnPopupHide=false;this.panRefreshAllowed=false;this.contentElements=false;this.debug=false;this.runOnReady=function(){if(typeof skinRunOnReadyBefore=="function"){skinRunOnReadyBefore()}this.setupGestureMessageView();this.setupGestureRefresh();bw.mobile=false;bw.iphone=false;bw.ipad=false;bw.touch=false;$("body").removeClass("noscroll");if(typeof rcs_disable_login_logo=="undefined"||rcs_disable_login_logo!=true){if($("#login-form").length){$("html").addClass("login-page");$("#bottomline").append("<a href='http://roundcubeskins.net' target='_blank' class='support-link'>RoundcubeSkins.net</a>")}}rcs_mobile.contentElements=$("#main-menu, #mainscreen, #planner_controls_container, #planner_items, #filter_bar, #notes");this.createPopupBoxes();this.fixButtons();$("#skin-options a").on("click",function(ev){rcs_mobile.popupHide(ev)});$("#attachment-list .delete").html("");if($("#messagelistcontainer").length){$("#messagelistcontainer").before("<div id='current-folder'><span></span></div>");rcs_mobile.updateCurrentFolder()}$("#mailboxlist li a").click(function(ev){rcs_mobile.updateCurrentFolder();rcs_mobile.popupHide(ev)});if($("#rcmlistfilter").length){this.filterActive=$("#rcmlistfilter").val()!="ALL";this.updateFunnel()}if($("#messagelistcontainer").length){rcs_mobile.setMailTimeout()}if($("#messagecontent .rightcol").length){$("#messagecontent .leftcol").after($("#messagecontent .rightcol"))}rcmail.addEventListener("aftermove",function(ev){rcs_mobile.addFolderSelectorHeader()});rcmail.addEventListener("aftercopy",function(ev){rcs_mobile.addFolderSelectorHeader()});if($(".btn-sectionslist").length){setTimeout(function(){rcmail.section_select(new settingsLoader("general"))},500)}if($("#compose-contacts .boxfooter a").length){$("#compose-contacts .boxfooter a").on("click",function(ev){rcs_mobile.popupHide(ev)})}if($("#header h5 select.deco").length){$("#header h5 select.deco").on("click",function(ev){ev.stopPropagation()})}if($(".remotehint")){setTimeout(function(){$(".remotehint").fadeOut()},3000)}$(".calendar-page #sectionslist .boxtitle.ui-widget-header a").on("click",function(){rcs_mobile.showCalendarOld("calendar")});if($("#groupoptionslink span.inner").length){$("#groupoptionslink span.inner").html("")}if(typeof skinRunOnReadyAfter=="function"){skinRunOnReadyAfter()}};this.addFolderSelectorHeader=function(){if(!$("#folder-selector h5").length){rcs_mobile.addPopupTitle($("#folder-selector"),rcs_label_folders);rcs_mobile.addPopupCloseButtonBar($("#folder-selector"));$("#folder-selector").on("mouseup",function(ev){rcs_mobile.popupHide(ev)})}};this.fixButtons=function(){$("a.firstpage, a.prevpage,a.nextpage, a.lastpage,a.listbutton.add span.inner,a.listbutton.delete span.inner,a.listbutton.removegroup span.inner").text("")};this.createPopupBoxes=function(){this.makePopup($("#header"),false);this.makePopup($("#mailview-left"),false);this.makePopup($("#quicksearchbar"),false);this.makePopup($("#mailtoolbar"),false);this.makePopup($("#messagetoolbar"));this.makePopup($("#settings-sections"),false);this.makePopup($("#addressbooktoolbar"));this.makePopup($("#composeview-left"),false);this.makePopup($("#groupoptions"),false);this.makePopup($("#mailboxmenu"),false);this.makePopup($("#filtersetmenu-menu"));this.makePopup($("#filtermenu-menu"));$("#filtersetmenulink").attr("onclick","rcs_mobile.popup(event, 'filtersetmenu-menu')");$("#filtermenulink").attr("onclick","rcs_mobile.popup(event, 'filtermenu-menu')");$("#filtersetslistbox a.add").text($("#filtersetslistbox a.add").attr("title")).appendTo("#filtersetmenu-menu");$("#filterslistbox a.add").text($("#filterslistbox a.add").attr("title")).appendTo("#filtermenu-menu");$("#mailboxmenulink").text($("#mailboxmenulink").attr("title"));$("#quicksearchbar").appendTo("body");$("#mailview-left").appendTo("body");$("#messagetoolbar").appendTo("body");this.addPopupTitle($("#mailboxmenu"),$("#mailboxmenulink").attr("title"));this.addPopupTitle($("#markmessagemenu"),$("#markmessagemenulink").text());this.addPopupTitle($("#messagemenu"),$("#messagemenulink").text());this.addPopupTitle($("#replyallmenu"),$(".button.reply").text());this.addPopupTitle($("#forwardmenu"),$(".button.forward").text());this.addPopupTitle($("#mailview-left"),rcs_label_folders);this.addPopupTitle($("#header"),$("#topline .username").html());this.addPopupTitle($("#quicksearchbar"),rcs_label_search);this.addPopupTitle($("#attachmentmenu"),rcs_label_attachment);this.addPopupTitle($("#settings-sections"),rcs_label_section);this.addPopupTitle($("#mailtoolbar"),rcs_label_options);this.addPopupTitle($("#composeview-left"),$("#composeview-left h2.boxtitle").text());this.addPopupTitle($("#responsesmenu"),$("#responsesmenu li.separator:first label").text());this.addPopupTitle($("#addressbooktoolbar"),rcs_label_options);this.addPopupTitle($("#groupoptions"),$("#aria-label-groupoptions").text());if($("a#spellmenulink").length){this.addPopupTitle($("#spellmenu"),$("a#spellmenulink").text())}else{this.addPopupTitle($("#spellmenu"),$("#mailtoolbar a.spellcheck").attr("title"))}if($(".calendar-page").length){this.addPopupTitle($("#messagetoolbar"),rcs_label_options)}else{this.addPopupTitle($("#messagetoolbar"),$("#taskbar .button-mail .button-inner").text())}$(".popupmenu").addClass("popup-box");if($("#groupoptionslink").length){$("#groupoptionslink").attr("onclick","rcs_mobile.popup(event, 'groupoptions')")}if($("#mailboxmenulink").length){$("#mailboxmenulink").attr("onclick","rcs_mobile.popup(event, 'mailboxmenu')")}$(".popup-box a").each(function(){var element=$(this);var onclick=element.attr("onclick");if(typeof onclick!="undefined"&&(onclick.indexOf("toggle_popup")!=-1||onclick.indexOf("command('move'")!=-1||onclick.indexOf("command('copy'")!=-1)){element.on("click",function(ev){rcs_mobile.popupDisappear(ev);setTimeout(function(){$(".popupmenu").addClass("popup-box");if(!$("#spellmenu").hasClass("processed")){$("#spellmenu").addClass("processed");$("#spellmenu a").on("click",function(ev){rcs_mobile.popupHide(ev)})}},0)})}});$(".button-skin-options").on("click",function(ev){rcs_mobile.popupDisappear(ev)});this.addPopupCloseButtonBar($(".popup-box"));if($(".login-page #header").length){$("#login-form").after("<a id='login-menu-button' href='javascript:void(0)' onclick='rcs_mobile.popup(event, \"header\")'></a>")}if($("#composebody").length){var toolbarName=$("#mailtoolbar").length?"mailtoolbar":"messagetoolbar";$("#main-menu").append("<a id='button-toolbar' href='javascript:void(0)' onclick='rcs_mobile.popup(event, \""+toolbarName+"\")'><span></span></a>");$("#popup-compose-settings").append($("#composeheaders .formlinks").html());$("#composeheaders .formlinks").html("");$("#popup-compose-settings a").each(function(){$(this).attr("onclick",$(this).attr("onclick").replace("UI.show_header_row","rcs_mobile.toggleCC"))});$("#popup-compose-settings").append($(".compose-headers a.iconlink.edit"));$("#popup-compose-settings").append($("#composeoptions"))}var filterSelect=false;if($("#rcmlistfilter").length){filterSelect="#rcmlistfilter"}else{if($("#searchfilter").length){filterSelect="#searchfilter"}}if(filterSelect){$(filterSelect+" option").each(function(){$("#popup-filter").append("<a href='javascript:void(0)' onclick='rcs_mobile.applyFilter(event, \""+$(this).val()+"\")'>"+$(this).text()+"</a>")})}if($("#quicksearchbar").length){$("#quicksearchbar form").after($("#searchmenu ul"));$("#quicksearchbar ul").after("<a class='search-apply' href='javascript:void(0)' onclick='rcs_mobile.applySearch(event, this)'>"+rcs_label_search+"</a><a class='search-reset' href='javascript:void(0)' onclick='rcs_mobile.resetSearch(event, this)'>"+$("#searchreset").attr("title")+"</a>");$("#quicksearchbar form").attr("onsubmit","rcs_mobile.applySearch(event); return false;")}$(".popupmenu").addClass("click-close");$(".popup-box.click-close").on("click",function(ev){rcs_mobile.popupHide(ev)});$(".popup-box select, .popup-box input[type='checkbox']").on("click",function(ev){ev.stopPropagation()});if($("#summarytable").length){$("#summarytable").html($("#summarytable").html().replace(/&nbsp;/g,""))}};this.makePopup=function(element,clickClose,popupId){if(!element.length){return}clickClose=typeof clickClose=="undefined"||clickClose?true:false;element.removeClass().addClass("popup-box");element.removeClass("toolbar");if(clickClose){element.addClass("click-close")}if(typeof popupId!="undefined"){element.attr("id",popupId)}element.appendTo("body")};this.addPopupCloseButtonBar=function(element){if(!element.length){return}element.prepend("<div class='popup-close'><a href='javascript:void(0)' onclick='rcs_mobile.popupHide(event, true, this)'></a></div>")};this.addPopupTitle=function(element,title){if(!element.length){return}var code="<h5>"+title+"</h5>";if(element.find(".popup-close").length){element.find(".popup-close").after(code)}else{element.prepend(code)}};this.popup=function(ev,id,onready){if($("#"+id+":visible").length){this.popupHide(ev,true);return}if(id=="messagetoolbar"){if($("#markmessagemenu-menu li a:first").attr("aria-disabled")=="true"){$("#markmessagemenulink, #messagemenulink").addClass("disabled")}else{$("#markmessagemenulink, #messagemenulink").removeClass("disabled")}}if($(".popup-box:visible").length){$(".popup-box").fadeOut();$("#"+id).fadeIn();return}$(".popup-box").hide();setTimeout(function(){$("#"+id).show();$("body").addClass("popup-visible");var partialWidth=105;var width=rcs_mobile.contentElements.outerWidth();rcs_mobile.contentElements.addClass("moved-container").animate({left:width-partialWidth,right:(width-partialWidth)*-1},300,"swing",onready)},0)};this.popupHide=function(ev,slide,closeButton){slide=typeof slide!=="undefined"?slide:false;ev.stopPropagation();var popup=typeof closeButton!=="undefined"?$(closeButton).parents(".popup-box"):false;if($(".popup-box:visible").length>1&&popup){popup.hide();return}$("body").removeClass("popup-visible");if(slide){rcs_mobile.contentElements.removeClass("moved-container").animate({left:0,right:0},300,"swing",function(){$(".popup-box").hide()})}else{rcs_mobile.contentElements.removeClass("moved-container").css("left",0).css("right",0);$(".popup-box").hide()}};this.popupDisappear=function(ev){this.log("popupDisappear");$(ev.target).parents(".popup-box").hide();ev.stopPropagation()};this.setMailTimeout=function(){rcs_mobile.mailTimer=setTimeout("rcs_mobile.mailTimout()",1000)};this.mailTimout=function(){rcs_mobile.fixMessageList();rcs_mobile.setMailTimeout()};this.fixMessageList=function(){var firstRow=$("#messagelist tr.message:first");if(!firstRow.length||firstRow.hasClass("processed")){return}firstRow.addClass("processed");var newListFormat=$("#aria-label-messagelist").length;$("#messagelist tr.message").each(function(){if(newListFormat){var rowId=$(this).attr("id");var uid=rcmail.message_list.list.rows[rowId].uid;rcmail.message_list.list.rows[rowId].onmousedown=null;rcmail.message_list.list.rows[rowId].onmouseup=null;$(this).removeAttr("onmouseup").removeAttr("onmousedown").unbind();rcmail.message_list.list.rows[rowId].onclick=function(e){rcmail.message_list.select_row(uid,CONTROL_KEY,true)};rcs_mobile.setupGestureMessageActions(rowId)}else{var uid=$(this).attr("id").substr(6);$(this).removeAttr("onmouseup").removeAttr("onmousedown").unbind().click(function(){rcmail.message_list.select_row(uid,CONTROL_KEY,true)})}if(!$(this).find(".subject a").length){var subject=$(this).find(".subject");subject.hide();subject.html(subject.html().replace("</span>","</span><a href='./?_task=mail&_action=show&_mbox="+rcmail.env.mailbox+"&_uid="+uid+"'>")+"</a>");subject.show()}if($(this).find(".fromto").length){$(this).find(".from").remove();$(this).find(".to").remove()}else{if($(this).find(".from").length){$(this).find(".to").remove()}}});$("#messagelist .subject a").removeAttr("onclick");$("#messagelist .subject a").removeAttr("onmouseover");$("#messagelist .subject a").on("click",function(e){e.stopPropagation()});var search_mods=rcmail.env.search_mods[rcmail.env.mailbox]?rcmail.env.search_mods[rcmail.env.mailbox]:rcmail.env.search_mods["*"];for(var n in search_mods){$("#s_mod_"+n).attr("checked",true)}$("#messagelistcontainer").append($("#countcontrols"))};this.updateFunnel=function(){$("#button-funnel").toggleClass("active",this.searchActive||this.filterActive);$(".funnel-filter").toggleClass("active",this.filterActive);$(".funnel-search").toggleClass("active",this.searchActive);if(this.searchActive||this.filterActive){this.blink($("#button-funnel span"))}};this.applySearch=function(ev,element){this.searchActive=true;rcmail.command("search","",element);rcs_mobile.updateFunnel(true);rcs_mobile.popupHide(ev)};this.resetSearch=function(ev,element){this.searchActive=false;rcmail.command("reset-search","",element,ev);rcs_mobile.updateFunnel();rcs_mobile.popupHide(ev)};this.applyFilter=function(ev,value){this.filterActive=value!="ALL";rcmail.filter_mailbox(value);rcs_mobile.updateFunnel();rcs_mobile.popupHide(ev)};this.blink=function(element){element.fadeOut("slow",function(){element.fadeIn("slow",function(){element.fadeOut("slow",function(){element.fadeIn("slow")})})})};this.updateCurrentFolder=function(){$("#current-folder span").html($("#mailboxcontainer li.selected a").html())};this.showCalendarOld=function(box){if(box=="sections"){$("#calendar-header").hide();$("#todaybutton").css("visibility","hidden");$("#prefs-box").css("visibility","hidden");$("#calendar").css("visibility","hidden");$("#tasks").css("visibility","hidden");$("#sectionslist").css("visibility","visible");$(".calendar-page #mainscreen").css("top",50);$("#main-menu #button-sections").addClass("active");$("#main-menu #button-calendar").removeClass("active");$("#main-menu #button-tasks").removeClass("active")}else{if(box=="calendar"){$("#calendar-header").show();$("#todaybutton").css("visibility","visible");$("#sectionslist").css("visibility","hidden");$("#prefs-box").css("visibility","visible");$("#tasks").css("visibility","hidden");$("#calendar").css("visibility","visible");$(".calendar-page #mainscreen").css("top",110);$("#main-menu #button-sections").removeClass("active");$("#main-menu #button-calendar").addClass("active");$("#main-menu #button-tasks").removeClass("active")}else{if(box=="tasks"){$("#calendar-header").hide();$("#todaybutton").css("visibility","hidden");$("#sectionslist").css("visibility","hidden");$("#prefs-box").css("visibility","visible");$("#calendar").css("visibility","hidden");$("#tasks").css("visibility","visible");$(".calendar-page #mainscreen").css("top",50);$("#main-menu #button-sections").removeClass("active");$("#main-menu #button-calendar").removeClass("active");$("#main-menu #button-tasks").addClass("active")}}}};this.showCalendar=function(box){if(box=="sections"){$("#calendar").css("visibility","hidden");$("#calendarsidebar").css("visibility","visible");$("#main-menu #button-sections").addClass("active");$("#main-menu #button-calendar").removeClass("active")}else{if(box=="calendar"){$("#calendar").css("visibility","visible");$("#calendarsidebar").css("visibility","hidden");$("#main-menu #button-sections").removeClass("active");$("#main-menu #button-calendar").addClass("active")}}};this.showTasks=function(box){if(box=="sections"){$(".tasklistview #sidebar").css("visibility","visible");$(".tasklistview #mainview-right").css("visibility","hidden");$("#main-menu #button-sections").addClass("active");$("#main-menu #button-tasks").removeClass("active")}else{if(box=="tasks"){$(".tasklistview #sidebar").css("visibility","hidden");$(".tasklistview #mainview-right").css("visibility","visible");$("#main-menu #button-sections").removeClass("active");$("#main-menu #button-tasks").addClass("active")}}};this.toggleCC=function(rowType){var style=$("#compose-"+rowType).attr("style");if(typeof style=="undefined"||style=="display: none;"){UI.show_header_row(rowType)}else{UI.hide_header_row(rowType)}};this.setupGestureRefresh=function(){if(!$("#messagelist").length||!$("#mainscreencontent").length){return}var limit=50;var target=$("#mainscreencontent");var screen=$("#mainscreen");var scroll=$("#messagelistcontainer");var hm=new Hammer(document.getElementById("mainscreencontent"));hm.on("hammer.input",function(ev){if(ev.direction!=Hammer.DIRECTION_NONE&&ev.direction!=Hammer.DIRECTION_UP&&ev.direction!=Hammer.DIRECTION_DOWN){return}var delta=ev.deltaY;if(delta>limit){delta=limit}if(delta<0){delta=0}if(ev.isFirst){if(!scroll.scrollTop()){rcs_mobile.panRefreshAllowed=true}return}if(ev.isFinal){if(!rcs_mobile.panRefreshAllowed){return}var restore=function(){target.css("top",0).removeClass("gesture-refresh");screen.removeClass("refresh").removeClass("ready");scroll.css("overflow-y","auto");$(window).unbind("touchmove");rcs_mobile.panRefreshAllowed=false};if(delta>=limit){rcmail.command("checkmail","",this,ev);setTimeout(restore,400)}else{setTimeout(restore,0)}return}if(ev.direction==Hammer.DIRECTION_DOWN){if(!rcs_mobile.panRefreshAllowed){return}$(window).bind("touchmove",function(e){e.preventDefault()});screen.addClass("refresh");if(delta==limit){screen.addClass("ready")}scroll.css("overflow-y","hidden");target.addClass("gesture-refresh");target.css("top",delta);return}if(ev.direction==Hammer.DIRECTION_UP){if(!rcs_mobile.panRefreshAllowed){return}target.css("top",delta);if(delta<limit){screen.removeClass("ready")}return}})};this.setupGestureMessageView=function(){if(!$("#messagecontent").length){return}var readyThreshold=70;var content=$("#mainscreencontent");var target=$("#messageheader");var background=$("#mailview-right");var screen=$("#mainscreen");target.hammer({direction:Hammer.DIRECTION_HORIZONTAL,threshold:10}).bind("pan",function(ev){if(ev.gesture.offsetDirection==Hammer.DIRECTION_LEFT){var direction="prev"}else{if(ev.gesture.offsetDirection==Hammer.DIRECTION_RIGHT){var direction="next"}else{return}}var disabled=(direction=="prev"&&$(".prevpage").hasClass("disabled"))||(direction=="next"&&$(".nextpage").hasClass("disabled"));background.addClass("gesture-pan");var delta=ev.gesture.deltaX;if(delta>readyThreshold){delta=readyThreshold}if(delta<readyThreshold*-1){delta=readyThreshold*-1}if(ev.gesture.isFinal){if(!disabled&&Math.abs(delta)==readyThreshold){content.fadeOut(200,function(){screen.addClass("progress");setTimeout(function(){rcmail.command(direction=="prev"?"previousmessage":"nextmessage","",this,"click")},100)});return}target.css("left",0);target.css("right",0);background.removeClass("gesture-pan");return}if(direction=="prev"){background.removeClass("next")}else{background.removeClass("prev")}background.addClass(direction);if(disabled){background.addClass("disabled")}else{background.removeClass("disabled");if(Math.abs(delta)==readyThreshold){background.addClass("ready")}else{background.removeClass("ready")}}target.css("left",delta);target.css("right",delta*-1)})};this.selectMessage=function(ev,rowId){rcmail.message_list.select_row(rcmail.message_list.list.rows[rowId].uid,"",true)};this.deleteMessage=function(ev,rowId){rcs_mobile.selectMessage(ev,rowId);rcmail.command("delete","",this,ev);rcmail.message_list.clear_selection();$("#mal-"+rowId).hide()};this.flagMessage=function(ev,rowId){this.selectMessage(ev,rowId);rcmail.command("mark","flagged",this,ev);rcmail.message_list.clear_selection();$("#mal-"+rowId).addClass("flagged");this.hideMessageActions(rowId)};this.unflagMessage=function(ev,rowId){this.selectMessage(ev,rowId);rcmail.command("mark","unflagged",this,ev);rcmail.message_list.clear_selection();$("#mal-"+rowId).removeClass("flagged");this.hideMessageActions(rowId)};this.showMoreOnMessage=function(ev,rowId){this.selectMessage(ev,rowId);this.clearSelectionOnPopupHide=true;this.hideMessageActions(rowId);rcs_mobile.popup(ev,"messagetoolbar")};this.hideMessageActions=function(rowId){$("#"+rowId).animate({width:$("#messagelist").width()},300)};this.setupGestureMessageActions=function(rowId){var row=$("#"+rowId);var boxWidth=180;var box=$("<div class='message-action-links'><a class='mal-more' href='javascript:void(0)' onclick='rcs_mobile.showMoreOnMessage(event, \""+rowId+"\")'></a><a class='mal-flag' href='javascript:void(0)' onclick='rcs_mobile.flagMessage(event, \""+rowId+"\")'></a><a class='mal-unflag' href='javascript:void(0)' onclick='rcs_mobile.unflagMessage(event, \""+rowId+"\")'></a><a class='mal-delete' href='javascript:void(0)' onclick='rcs_mobile.deleteMessage(event, \""+rowId+"\")'></a></div>").attr("id","mal-"+rowId);if(row.hasClass("flagged")){box.addClass("flagged")}row.before(box);row.hammer({direction:Hammer.DIRECTION_HORIZONTAL,threshold:30}).bind("pan",function(ev){if(ev.gesture.offsetDirection==Hammer.DIRECTION_LEFT){var direction="right"}else{if(ev.gesture.offsetDirection==Hammer.DIRECTION_RIGHT){var direction="left"}else{return}}if(!rcs_mobile.panDirection){rcs_mobile.panDirection=direction}var fullWidth=$("#messagelist").width();var delta=ev.gesture.deltaX;if(rcs_mobile.panDirection=="left"&&delta<boxWidth*-1){delta=boxWidth*-1}if(rcs_mobile.panDirection=="right"&&delta>boxWidth){delta=boxWidth}if((rcs_mobile.panDirection=="left"&&delta>0)||(rcs_mobile.panDirection=="right"&&delta<0)){delta=0}if(ev.gesture.isFinal){if(direction=="left"){if(row.width()<fullWidth-boxWidth*0.3){if(rcs_mobile.actionRowOpen&&rcs_mobile.actionRowOpen!=rowId){rcs_mobile.hideMessageActions(rcs_mobile.actionRowOpen)}rcs_mobile.actionRowOpen=rowId;row.animate({width:fullWidth-boxWidth},100)}else{row.animate({width:fullWidth},100,"swing",function(){row.css("width","100%")});$("#mal-"+rowId).hide()}}else{if(row.width()>fullWidth-boxWidth*0.7){row.animate({width:fullWidth},100,"swing",function(){row.css("width","100%")});rcs_mobile.actionRowOpen=false;$("#mal-"+rowId).hide()}else{row.animate({width:fullWidth-boxWidth},100)}}rcs_mobile.panDirection=false;return}$("#mal-"+rowId).show();if(rcs_mobile.panDirection=="left"){if(row.width()>fullWidth-boxWidth){row.width(fullWidth+delta)}}else{if(row.width()<fullWidth){row.width(fullWidth-boxWidth+delta)}}})};this.log=function(string){if(this.debug){console.log(string)}}};function settingsLoader(value){this.value=value;this.get_single_selection=function(){return this.value}};